<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Veterinaria.ViewModels"
             x:Class="Veterinaria.Views.EditarCita"
             x:Name="PageRef"
             BackgroundColor="#F5F5F5">

    <ContentPage.BindingContext>
        <viewmodels:EditarCitaViewModel />
    </ContentPage.BindingContext>

    <Grid>
        <!-- Capa base: contenido principal -->
        <ScrollView>
            <VerticalStackLayout Padding="20">
                <Label Text="Paciente:" FontSize="18" />
                <Picker ItemsSource="{Binding Pacientes}"
ItemDisplayBinding="{Binding Nombre}"
SelectedItem="{Binding PacienteSeleccionado}" />

                <Label Text="Veterinario:" FontSize="18" />
                <Picker ItemsSource="{Binding Veterinarios}"
ItemDisplayBinding="{Binding Nombre_pila}"
SelectedItem="{Binding VeterinarioSeleccionado}" />

                <Label Text="Motivo:" FontSize="18" />
                <Entry Text="{Binding Cita.Motivo}" />

                <Label Text="Peso:" FontSize="18" />
                <Entry Text="{Binding Cita.Peso}" Keyboard="Numeric" />

                <Label Text="Fecha:" FontSize="18" />
                <DatePicker Date="{Binding Cita.FechaCita}" />

                <Label Text="Hora:" FontSize="18" />
                <TimePicker Time="{Binding Cita.FechaCita.TimeOfDay}" />

                <!-- Medicamentos -->
                <Label Text="Medicamentos:" FontSize="18" />
                <CollectionView ItemsSource="{Binding Cita.Medicamentos}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding Nombre}" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                <Button Text="Agregar medicamento"
Command="{Binding AbrirModalMedicamentosCommand}" />

                <!-- Servicios -->
                <Label Text="Servicios:" FontSize="18" />
                <CollectionView ItemsSource="{Binding Cita.Servicios}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding Nombre}" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                <Button Text="Agregar servicio"
Command="{Binding AbrirModalServiciosCommand}" />

                <!-- Guardar -->
                <Button Text="Guardar cambios"
Command="{Binding GuardarCitaCommand}"
BackgroundColor="#F17105"
TextColor="White"
HeightRequest="50"
FontSize="18"
CornerRadius="20" />
                <!-- ...todo tu contenido principal (sin los modales)... -->
            </VerticalStackLayout>
        </ScrollView>

        <!-- Modal Medicamentos -->
        <ContentView IsVisible="{Binding MostrarModalMedicamentos}"
                     BackgroundColor="#80000000"
                     HorizontalOptions="Fill"
                     VerticalOptions="Fill"
                     Grid.Row="0" Grid.Column="0">
            <Grid>
                <Frame Padding="20"
                       BackgroundColor="White"
                       CornerRadius="15"
                       VerticalOptions="Center"
                       HorizontalOptions="Center">
                    <Label Text="Selecciona un medicamento" FontSize="20" />
                    <CollectionView ItemsSource="{Binding MedicamentosDisponibles}" SelectionMode="Single"
                                    SelectedItem="{Binding MedicamentoSeleccionado}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding Nombre}" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <Button Text="Agregar" Command="{Binding AgregarMedicamentoCommand}" />
                    <Button Text="Cerrar" Command="{Binding CerrarModalMedicamentosCommand}" />
                </Frame>
            </Grid>
        </ContentView>

        <!-- Modal Servicios -->
        <ContentView IsVisible="{Binding MostrarModalServicios}"
                     BackgroundColor="#80000000"
                     HorizontalOptions="Fill"
                     VerticalOptions="Fill"
                     Grid.Row="0" Grid.Column="0">
            <Grid>
                <Frame Padding="20"
                       BackgroundColor="White"
                       CornerRadius="15"
                       VerticalOptions="Center"
                       HorizontalOptions="Center">
                    <Label Text="Selecciona un servicio" FontSize="20" />
                    <CollectionView ItemsSource="{Binding ServiciosDisponibles}" SelectionMode="Single"
                                    SelectedItem="{Binding ServicioSeleccionado}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding Nombre}" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <Button Text="Agregar" Command="{Binding AgregarServicioCommand}" />
                    <Button Text="Cerrar" Command="{Binding CerrarModalServiciosCommand}" />
                </Frame>
            </Grid>
        </ContentView>
    </Grid>
</ContentPage>

